---
- name: "Check backup directory exists"
  file:
    path: "{{ BACKUP_DIR }}/"
    state: directory

- name: "Check how many backups exists"
  shell: "fin drush sql-dump > {{ BACKUP_DIR }}/backup-{{ ansible_date_time.date }}-{{ ansible_date_time.time }}.sql"
  args:
    chdir: "{{ BUILD_DIR }}/{{ DRUPAL_DOCROOT }}"
    executable: /bin/zsh

- name: "Check how many backups exists"
  shell: ls -ltc
  args:
    chdir: "{{ BACKUP_DIR }}"
    executable: /bin/zsh
  register: files

- set_fact:
    num_files: "{{ files.stdout_lines|list|length }}"

- debug:
    msg: "Found {{ num_files }} files"